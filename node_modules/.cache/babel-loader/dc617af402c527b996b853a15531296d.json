{"ast":null,"code":"/**\n * Created by mauricio on 3/29/15.\n */\n'use strict';\n\nvar d3 = window.d3;\n\nvar evaluate = require('../evaluate');\n\nvar utils = require('../utils');\n\nvar clamp = require('clamp');\n\nmodule.exports = function (chart) {\n  var xScale = chart.meta.xScale;\n  var yScale = chart.meta.yScale;\n\n  function plotLine(selection) {\n    selection.each(function (d) {\n      var el = plotLine.el = d3.select(this);\n      var index = d.index;\n      var evaluatedData = evaluate(chart, d);\n      var color = utils.color(d, index);\n      var innerSelection = el.selectAll(':scope > path.line').data(evaluatedData);\n      var yRange = yScale.range();\n      var yMax = yRange[0];\n      var yMin = yRange[1]; // workaround, clamp assuming that the bounds are finite but huge\n\n      var diff = yMax - yMin;\n      yMax += diff * 1e6;\n      yMin -= diff * 1e6;\n\n      if (d.skipBoundsCheck) {\n        yMax = Infinity;\n        yMin = -Infinity;\n      }\n\n      function y(d) {\n        return clamp(yScale(d[1]), yMin, yMax);\n      }\n\n      var line = d3.svg.line().interpolate('linear').x(function (d) {\n        return xScale(d[0]);\n      }).y(y);\n      var area = d3.svg.area().x(function (d) {\n        return xScale(d[0]);\n      }).y0(yScale(0)).y1(y);\n      innerSelection.enter().append('path').attr('class', 'line line-' + index).attr('stroke-width', 1).attr('stroke-linecap', 'round'); // enter + update\n\n      innerSelection.each(function () {\n        var path = d3.select(this);\n        var pathD;\n\n        if (d.closed) {\n          path.attr('fill', color);\n          path.attr('fill-opacity', 0.3);\n          pathD = area;\n        } else {\n          path.attr('fill', 'none');\n          pathD = line;\n        }\n\n        path.attr('stroke', color).attr('marker-end', function () {\n          // special marker for vectors\n          return d.fnType === 'vector' ? 'url(#' + chart.markerId + ')' : null;\n        }).attr('d', pathD);\n      }).attr(d.attr);\n      innerSelection.exit().remove();\n    });\n  }\n\n  return plotLine;\n};","map":null,"metadata":{},"sourceType":"script"}